window.__require=function e(t,n,o){function i(l,a){if(!n[l]){if(!t[l]){var c=l.split("/");if(c=c[c.length-1],!t[c]){var s="function"==typeof __require&&__require;if(!a&&s)return s(c,!0);if(r)return r(c,!0);throw new Error("Cannot find module '"+l+"'")}l=c}var u=n[l]={exports:{}};t[l][0].call(u.exports,function(e){return i(t[l][1][e]||e)},u,u.exports,e,t,n,o)}return n[l].exports}for(var r="function"==typeof __require&&__require,l=0;l<o.length;l++)i(o[l]);return i}({all_modules:[function(e,t,n){"use strict";cc._RF.push(t,"090e8xDLQRAgKX2HKPophnx","all_modules");var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n),Object.defineProperty(e,o,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),i=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||o(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),n.types=void 0,i(e("../services/utils/utils_common"),n),i(e("./configurations/config_game"),n),n.types=e("./system_types"),i(e("../services/utils/utils_data"),n),i(e("../services/utils/utils_ui"),n),i(e("../services/utils/utils_anim_fx"),n),i(e("../services/audio"),n),i(e("../system/app_events"),n),i(e("../system/ui-fx/core_fx"),n),i(e("../system/ui-fx/core_ui"),n),i(e("../core-game/settings"),n),i(e("../core-game/map_visual"),n),i(e("../core-game/block_local_cells"),n),i(e("../core-game/game_mechanic"),n),i(e("../core-game/cell_mechanic"),n),i(e("../core-game/power_item"),n),i(e("../core-game/tutorial"),n),i(e("../core-game/game_flow"),n),i(e("../control/control"),n),cc._RF.pop()},{"../control/control":"control","../core-game/block_local_cells":"block_local_cells","../core-game/cell_mechanic":"cell_mechanic","../core-game/game_flow":"game_flow","../core-game/game_mechanic":"game_mechanic","../core-game/map_visual":"map_visual","../core-game/power_item":"power_item","../core-game/settings":"settings","../core-game/tutorial":"tutorial","../services/audio":"audio","../services/utils/utils_anim_fx":"utils_anim_fx","../services/utils/utils_common":"utils_common","../services/utils/utils_data":"utils_data","../services/utils/utils_ui":"utils_ui","../system/app_events":"app_events","../system/ui-fx/core_fx":"core_fx","../system/ui-fx/core_ui":"core_ui","./configurations/config_game":"config_game","./system_types":"system_types"}],app_events:[function(e,t,n){"use strict";cc._RF.push(t,"10990IZBkRJQLreM2+T4aIH","app_events"),Object.defineProperty(n,"__esModule",{value:!0}),n.appEvents=void 0;var o=e("../system/all_modules"),i=o._;o.$,n.appEvents={isAppHidden:!1,onAppShowCallbackArr:[],onAppHideCallbackArr:[],lastAppHideMsUTC:0,onAppShow:function(){this.isAppHidden=!1,this.onAppShowCallbackArr.map(function(e){return e()}),this.lastAppHideMsUTC=i.getMsPassedUTC()},addAppShowCallback:function(e){this.onAppShowCallbackArr.push(e)},onAppHide:function(){this.isAppHidden=!0,this.onAppHideCallbackArr.map(function(e){return e()})},addAppHideCallback:function(e){this.onAppHideCallbackArr.push(e)}},cc._RF.pop()},{"../system/all_modules":"all_modules"}],audio:[function(e,t,n){"use strict";cc._RF.push(t,"57d370T3gNMWJXIo0x1feW9","audio");var o=this&&this.__spreadArrays||function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var o=Array(e),i=0;for(t=0;t<n;t++)for(var r=arguments[t],l=0,a=r.length;l<a;l++,i++)o[i]=r[l];return o};Object.defineProperty(n,"__esModule",{value:!0}),n.audio=void 0;var i=e("../system/all_modules"),r=i._,l=(i.$,["bgm_NountrisThemeSong","bgm_Stage1","bgm_Stage2","bgm_Stage3","bgm_Stage4","bgm_Stage5","bgm_Stage6","bgm_Stage7","bgm_Stage8","bgm_Stage9","bgm_Stage10","bgm_Stage11","bgm_Stage12","bgm_Stage13"]),a=["BlockLand","BlockRotate","LineScoreTetris"];n.audio={audioList:{},playingIdList:{},currentStreakSoundIndex:0,lastStreakTime:0,init:function(){var e=this;r.setTimeout(function(){return e.loadAudioFiles()},0);var t={checkFunc:null};t.checkFunc=function(){return e.audioList[l[0]]&&i.settings.isInitialized},r.waitToRun(function(){return e.playBgMusic()},"checkFunc()",t)},loadAudioFiles:function(){var e=this;o(a,[l[0]]).map(function(t){cc.resources.load("audios/"+t,cc.AudioClip,function(n,o){return!n&&(e.audioList[t]=o)})}),cc.resources.loadDir("audios",cc.AudioClip,function(t,n){if(t)return r.log(t);for(var o=0,i=n;o<i.length;o++){var l=i[o];e.audioList[l.name]=l}})},playSound:function(e,t,n){if(void 0===t&&(t=.6),void 0===n&&(n=!1),"off"!=i.settings.sound&&this.audioList[e])try{this.playingIdList[e]=cc.audioEngine.play(this.audioList[e],n,t)}catch(o){}},stopSound:function(e){this.playingIdList[e]&&cc.audioEngine.stopEffect(this.playingIdList[e])},currentBgmIndex:0,playBgMusic:function(e){var t=this;void 0===e&&(e=.6);try{var n=l[this.currentBgmIndex++%l.length],o=this.playingIdList[n]=cc.audioEngine.playMusic(this.audioList[n],!1);cc.audioEngine.setFinishCallback(o,function(){r.setTimeout(function(){return t.playBgMusic()})}),cc.audioEngine.setMusicVolume("off"==i.settings.music?0:e)}catch(a){r.log("playMusic err ",a)}},muteBgMusic:function(){cc.audioEngine.setMusicVolume(0)},unmuteBgMusic:function(){cc.audioEngine.setMusicVolume(.6)},playSoundClickButton:function(){"off"!=i.settings.sound&&this.playSound("button_click",1)},onGameOver:function(){this.muteBgMusic(),this.playSound("GameOver")},onReplay:function(){this.stopSound("GameOver"),"off"!=i.settings.music&&this.unmuteBgMusic()}},cc._RF.pop()},{"../system/all_modules":"all_modules"}],bind_button_handlers:[function(e,t,n){"use strict";cc._RF.push(t,"9c123Lu5L1HWKu7kgQRu2Dk","bind_button_handlers"),Object.defineProperty(n,"__esModule",{value:!0}),n.bindButtonHandlers=void 0;var o=e("../../system/all_modules"),i=o._;n.bindButtonHandlers={run:function(){o.utilsUI.makeButton(cc.find("Canvas/play_area/btn_debug"),function(){o.gameMechanic.pause(),cc.find("Canvas/play_area/elem_container_debug").removeAllChildren(),o.gameMechanic.fixedCellPosArr.map(function(e){i.copyNode(cc.find("Canvas/sample_nodes/debug_node"),cc.find("Canvas/play_area/elem_container_debug")).setPosition(o.cellMechanic.cellPosToRealPos(e.x,e.y))})}),o.utilsUI.makeButton(cc.find("Canvas/play_area/btn_toggle_debug_layer"),function(){cc.find("Canvas/play_area/elem_container_debug").children.map(function(e){e.active=!e.active})}),o.utilsUI.makeButton(cc.find("Canvas/layer_pause/dialog/btn_music"),function(){return o.settings.onBtnMusic()}),o.utilsUI.makeButton(cc.find("Canvas/layer_pause/dialog/btn_music/btn_music_off"),function(){return o.settings.onBtnMusicOff()}),o.utilsUI.makeButton(cc.find("Canvas/layer_pause/dialog/btn_sound"),function(){return o.settings.onBtnSound()}),o.utilsUI.makeButton(cc.find("Canvas/layer_pause/dialog/btn_sound/btn_sound_off"),function(){return o.settings.onBtnSoundOff()}),o.utilsUI.makeButton(cc.find("Canvas/layer_pause/dialog/btn_resume"),function(){o.gameMechanic.resume()}),o.utilsUI.makeButton(cc.find("Canvas/layer_pause/dialog/btn_replay"),function(){o.coreUI.hideLayout("layer_pause"),o.gameMechanic.replay()}),o.utilsUI.makeButton(cc.find("Canvas/layer_game_over/dialog/btn_replay"),function(){o.coreUI.hideLayout("layer_game_over"),o.gameMechanic.replay()})}},cc._RF.pop()},{"../../system/all_modules":"all_modules"}],block_local_cells:[function(e,t,n){"use strict";var o;cc._RF.push(t,"525ac8QLTdEpY0grC6apCTX","block_local_cells"),Object.defineProperty(n,"__esModule",{value:!0}),n.blockLocalCells=void 0;var i=e("../system/all_modules"),r=(i._,i.$,i.types.blockType);n.blockLocalCells=((o={})[r.I]=[[[0,0],[1,0],[2,0],[3,0]],[[0,0],[0,1],[0,2],[0,3]],[[3,0],[2,0],[1,0],[0,0]],[[0,3],[0,2],[0,1],[0,0]]],o[r.J]=[[[0,1],[0,0],[1,0],[2,0]],[[0,0],[1,0],[1,1],[1,2]],[[2,0],[2,1],[1,1],[0,1]],[[1,2],[0,2],[0,1],[0,0]]],o[r.L]=[[[0,2],[0,1],[0,0],[1,0]],[[0,0],[1,0],[2,0],[2,1]],[[1,0],[1,1],[1,2],[0,2]],[[2,1],[1,1],[0,1],[0,0]]],o[r.O]=[[[0,1],[1,1],[0,0],[1,0]]],o[r.S]=[[[0,2],[0,1],[1,1],[1,0]],[[0,0],[1,0],[1,1],[2,1]],[[1,0],[1,1],[0,1],[0,2]],[[2,1],[1,1],[1,0],[0,0]]],o[r.T]=[[[0,1],[1,1],[2,1],[1,0]],[[0,0],[0,1],[0,2],[1,1]],[[2,0],[1,0],[0,0],[1,1]],[[1,2],[1,1],[1,0],[0,1]]],o[r.Z]=[[[0,0],[0,1],[1,1],[1,2]],[[2,0],[1,0],[1,1],[0,1]],[[1,2],[1,1],[0,1],[0,0]],[[0,1],[1,1],[1,0],[2,0]]],o),cc._RF.pop()},{"../system/all_modules":"all_modules"}],cell_mechanic:[function(e,t,n){"use strict";cc._RF.push(t,"5ccf20UgJNE2J97LjkVPxGr","cell_mechanic"),Object.defineProperty(n,"__esModule",{value:!0}),n.cellMechanic=void 0;var o=e("../system/all_modules"),i=o._,r=(o.$,o.gameMechanic);n.cellMechanic={currentCellX:0,currentCellY:0,currentSpinState:0,currentLocalCellArr:[],currentBlockCellMaxX:0,currentBlockCellMaxY:0,reset:function(){Object.assign(this,{currentCellX:0,currentCellY:0,currentSpinState:0,currentLocalCellArr:[],currentBlockCellMaxX:0,currentBlockCellMaxY:0})},setBlockCellPos:function(e,t,n,i){var l;if(void 0===e&&(e=null),void 0===t&&(t=null),void 0===n&&(n=!1),void 0===i&&(i=!1),!(r.isGameOver||r.isPlayingAnim||(null===e&&(e=this.currentCellX),null===t&&(t=this.currentCellY),e<1))){var a=this.isNewCellPosInvalid(e,t);if(a&&(0!=this.currentCellY&&this.currentCellY!=t+1||r.stopBlockFalling(),!n))return"hit_bottom";a||(l=[e,t],this.currentCellX=l[0],this.currentCellY=l[1]);var c=this.cellPosToRealPos(e,t);return a&&!n||(i?(cc.tween(r.currentBlockNode).to(.25,{position:c}).start(),o.coreFX.showFastDropParticle({x:e,y:t})):r.currentBlockNode.setPosition(c)),a&&n?"hit_fixed_cells":null}},isNewCellPosInvalid:function(e,t,n){return void 0===n&&(n=null),(n||this.currentLocalCellArr).some(function(n){var i=n[0],l=n[1];return i+e<1||i+e>o.mapVisual.mapCellWidth||l+t<0||l+t>o.mapVisual.mapCellHeight-1||r.getFixedCellPos({x:e+i,y:t+l})})},getAllCellPosOfRow:function(e){return i.getNumberArray(1,o.mapVisual.mapCellWidth).map(function(t){return{x:t,y:e}})},rotateBlock:function(e){if(!(void 0===e&&(e=!1),r.isGameOver||r.isPaused||o.powerItems.isUsingItem||this.rotateBlockTestPosY(e))){if(this.isNewCellPosInvalid(this.currentCellX,this.currentCellY-1))return;if(this.setBlockCellPos(null,this.currentCellY-1),!this.rotateBlockTestPosY(e)){if(this.isNewCellPosInvalid(this.currentCellX,this.currentCellY-1))return;if(this.setBlockCellPos(null,this.currentCellY-1),!this.rotateBlockTestPosY(e)){if(this.isNewCellPosInvalid(this.currentCellX,this.currentCellY-1))return this.setBlockCellPos(null,this.currentCellY+2);this.setBlockCellPos(null,this.currentCellY-1),this.rotateBlockTestPosY(e)||this.setBlockCellPos(null,this.currentCellY+3)}}}},rotateBlockTestPosY:function(e){for(var t=this,n=[this.currentBlockCellMaxX,this.currentBlockCellMaxY],l=n[0],a=n[1],c=i.max(l,a),s=l>a?[0,c]:[-c,0],u=s[0],d=s[1],m=this.currentCellX,f=!1,p=[],h=[],v=u;v<=d;v++)p.push(v);for(v=u;v<=d;v++)h.push(p[v%2?"shift":"pop"]());var g=e?3:1,_=this.setBlockLocalCells((this.currentSpinState+g)%4,!0);if(h.reverse().some(function(e){var n=t.currentCellX+e;if(!t.isNewCellPosInvalid(n,t.currentCellY,_))return m=n,f=!0,!0}),f){this.currentSpinState+=g,this.setBlockLocalCells(this.currentSpinState%4);var y=r.currentBlockNode.visualNode;return y.angle=90*this.currentSpinState,y.x=y.y=0,1==this.currentSpinState&&(y.x=y.height*y.scale),2==this.currentSpinState&&(y.x=y.width*y.scale),2==this.currentSpinState&&(y.y=y.height*y.scale),3==this.currentSpinState&&(y.y=y.width*y.scale),this.setBlockCellPos(m),o.audio.playSound("BlockRotate"),!0}},fastDropBlock:function(){if(!(r.isGameOver||r.isPaused||o.powerItems.isUsingItem)){i.clearInterval(r.blockFallTimerVar);for(var e=0;e<o.mapVisual.mapCellHeight&&"hit_bottom"!=this.setBlockCellPos(null,this.currentCellY-1,!1,!0);e++)r.statistic.currentDropScore+=o.configGame.hardDropScore,r.statistic.score+=o.configGame.hardDropScore,o.coreUI.updateStats()}},onFallDown1Cell:function(e){void 0===e&&(e=!1),r.isGameOver||r.isPaused||o.powerItems.isUsingItem||"hit_bottom"!=this.setBlockCellPos(null,this.currentCellY-1)&&(r.statistic.currentDropScore+=o.configGame.softDropScore,r.statistic.score+=o.configGame.softDropScore,o.coreUI.updateStats(),o.coreFX.showFastDropParticle({x:this.currentCellX,y:this.currentCellY}))},setBlockLocalCells:function(e,t){var n=this;void 0===e&&(e=0),void 0===t&&(t=!1);var l=o.blockLocalCells[r.currentBlockType],a=e%l.length;if(t)return l[a];this.currentSpinState=a,this.currentLocalCellArr=l[a],this.currentBlockCellMaxX=i.max.apply(i,this.currentLocalCellArr.map(function(e){return e[0]})),this.currentBlockCellMaxY=i.max.apply(i,this.currentLocalCellArr.map(function(e){return e[1]})),r.currentBlockNode.visualNode.children.map(function(e,t){e.cellPos=cc.v2.apply(cc,n.currentLocalCellArr[t])})},cellPosToRealPos:function(e,t){return cc.v2(e-1,t).mul(o.mapVisual.cellWidthInPx).sub(cc.v2(o.mapVisual.gridNode.width/2,o.mapVisual.gridNode.height/2))},getSingleCellNode:function(e){return r.elemContainer.children.find(function(t){return t.cellPos&&t.cellPos.x==e.x&&t.cellPos.y==e.y})}},cc._RF.pop()},{"../system/all_modules":"all_modules"}],config_game:[function(e,t,n){"use strict";cc._RF.push(t,"e2516totLFCXanAqceflU53","config_game"),Object.defineProperty(n,"__esModule",{value:!0}),n.configGame=void 0;var o=e("../all_modules"),i=o._,r=(o.$,cc.macro.KEY);n.configGame={init:function(){},blockFallTimeFactor:50,scoringFactor:[10,30,50,80],extraScoringFactor:900,softDropScore:1,hardDropScore:2,comboExtraScore:100,levelScoreScale:[{maxLevel:10,pointEachLevel:300},{maxLevel:20,pointEachLevel:400},{maxLevel:40,pointEachLevel:500},{maxLevel:100,pointEachLevel:1e3},{maxLevel:1/0,pointEachLevel:2e4}],scoreToLevel:function(e){var t=1,n=0,o=0;return this.levelScoreScale.some(function(r){var l=r.maxLevel,a=r.pointEachLevel,c=n;if(e<(n+=a*l))return t=o+i.ceil((e-c)/a),!0;o=l}),t||1},powerItemShiftKey:r.shift,powerItemKeys:{bomb:[r.up,r.up,r.down],drill:[r.up,r.down,r.down],pylon:[r.left,r.right,r.left],noggle:[r.left,r.up,r.right]},powerItemCoolDownTime:{bomb:35,drill:30,pylon:20,noggle:110},powerItemMaxNumber:{bomb:2,drill:2,pylon:3,noggle:1},powerItemAbilities:{bomb:{explosionRange:{width:6,height:6}},pylon:{explodeScore:100},noggle:{maxSmashLine:8}}},cc._RF.pop()},{"../all_modules":"all_modules"}],control:[function(e,t,n){"use strict";cc._RF.push(t,"1ddf8FW8cNGapuroxBoKhVq","control"),Object.defineProperty(n,"__esModule",{value:!0}),n.control=void 0;var o=e("../system/all_modules"),i=o._;o.$,n.control={isShiftKeyIsPressed:!1,powerItemKeyCode:{},keyCodeToPowerItemName:{},currentPowerItemKeyPressed:[],init:function(){for(var e in this.initKeyboardControl(),this.initMouseControl(),o.configGame.powerItemKeys)this.keyCodeToPowerItemName[o.configGame.powerItemKeys[e].join("_")]=e},onKeyDownWhenShiftPressed:function(e){var t,n=this,i=function(){return n.currentPowerItemKeyPressed=[]};if(this.currentPowerItemKeyPressed.push(e),o.coreUI.updatePowerItemArrowKeys(),t=n.currentPowerItemKeyPressed.join("_"),!Object.keys(n.keyCodeToPowerItemName).find(function(e){return e.startsWith(t)}))return i();var r=this.keyCodeToPowerItemName[this.currentPowerItemKeyPressed.join("_")];r&&(i(),o.powerItems.onUse(r))},initKeyboardControl:function(){var e=this,t={},n=function(e,n,o){void 0===o&&(o=.1),n(),t[e]=i.setInterval(function(){return n()},1e3*o)},r=function(e){i.clearInterval(t[e])},l=[],a=function(e){var t;switch(e.keyCode){case cc.macro.KEY.left:case cc.macro.KEY.a:t="left";break;case cc.macro.KEY.right:case cc.macro.KEY.d:t="right";break;case cc.macro.KEY.up:case cc.macro.KEY.w:case cc.macro.KEY.z:t="top";break;case cc.macro.KEY.x:t="rotateRight";break;case cc.macro.KEY.down:case cc.macro.KEY.s:t="bottom";break;case cc.macro.KEY.space:t="fastdrop";break;case cc.macro.KEY.escape:t="pause";break;case cc.macro.KEY.shift:t="shift"}return t},c=o.gameMechanic,s=o.cellMechanic,u=o.powerItems;cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN,function(t){var i=a(t);l.includes(i)||(l.push(i),"pause"==i&&(c.isPaused?c.resume():c.pause()),c.isPaused||c.isGameOver||("fastdrop"==i?n(i,function(){o.powerItems.isUsingItem?u.isItemFalling&&u.fastDropItem():s.fastDropBlock()},.3):"shift"==i?e.isShiftKeyIsPressed=!0:e.isShiftKeyIsPressed?e.onKeyDownWhenShiftPressed(t.keyCode):"left"==i?n(i,function(){o.powerItems.isUsingItem?u.isItemFalling&&u.setItemCellPos(u.currentCellX-1,null):s.setBlockCellPos(s.currentCellX-1,null)}):"right"==i?n(i,function(){o.powerItems.isUsingItem?u.isItemFalling&&u.setItemCellPos(u.currentCellX+1,null):s.setBlockCellPos(s.currentCellX+1,null)}):"top"==i?n(i,function(){s.rotateBlock()},.2):"rotateRight"==i?n(i,function(){s.rotateBlock(!0)},.2):"bottom"==i&&n(i,function(){o.powerItems.isUsingItem?u.isItemFalling&&(u.setItemCellPos(null,u.currentCellY-1),o.powerItems.showTrailingVfx()):s.onFallDown1Cell(!0)},.05)))},this),cc.systemEvent.on(cc.SystemEvent.EventType.KEY_UP,function(t){var n=a(t);"shift"==n&&(e.isShiftKeyIsPressed=!1,e.currentPowerItemKeyPressed=[],o.coreUI.updatePowerItemArrowKeys()),i.removeArrayItem(l,n),r(n),l.length},this)},initMouseControl:function(){var e=i.getGlobalPos(o.mapVisual.gridNode).x,t=o.mapVisual.gridNode.width/o.mapVisual.mapCellWidth,n=-100,r=o.gameMechanic;cc.find("Canvas").on("mousemove",function(l){if(!r.isPaused&&!r.isGameOver){var a=l.getLocation().x+o.mapVisual.gridNode.width/2,c=i.round(.5+(a-e)/t);if((c=i.max(i.min(c,o.mapVisual.mapCellWidth),1))!=n){n=c,cc.find("Canvas/play_area/grid/cell_indicator").x=(c-.5)*t-o.mapVisual.gridNode.width/2;var s=o.cellMechanic;1==i.abs(c-s.currentCellX)&&s.setBlockCellPos(c,s.currentCellY)}}})}},cc._RF.pop()},{"../system/all_modules":"all_modules"}],core_fx:[function(e,t,n){"use strict";cc._RF.push(t,"58583JUlBRDj43pXro2UfkX","core_fx"),Object.defineProperty(n,"__esModule",{value:!0}),n.coreFX=void 0;var o=e("../../system/all_modules"),i=o._,r=(o.$,["#666666","#653535","#418145","#417481","#4c4181","#7b4181","#a74c73","#b2814d"]);n.coreFX={fxContainer:null,particleBlockFastDrop:null,particleBlockLands:null,particleScoreSingleLine:null,particleCombo4Lines:null,particleBomb:null,particlePylonExplode:null,isBGAnimating:!1,init:function(){this.fxContainer=cc.find("Canvas/fx_container"),this.particleBlockFastDrop=cc.find("Canvas/fx_container/drop_fast"),this.particleBlockLands=cc.find("Canvas/fx_container/block_lands"),this.particleScoreSingleLine=cc.find("Canvas/sample_nodes/vfx_single_line_score"),this.particleCombo4Lines=cc.find("Canvas/fx_container/vfx_4_lines_combo"),this.particleBomb=cc.find("Canvas/fx_container/bomb_explosion"),this.particlePylonExplode=cc.find("Canvas/sample_nodes/vfx_pylon_explode")},drillParticles:function(e){var t=i.copyNode(cc.find("Canvas/sample_nodes/vfx_drill_explode"),this.fxContainer);i.setGlobalPosToNode(t,e),t.active=!0,o.utilsAnimFx.replayParticle(t.children[0]),i.setTimeout(function(){return t.removeFromParent(!0)},1200)},pylonExplosion:function(e){var t=i.copyNode(this.particlePylonExplode,this.fxContainer);i.setGlobalPosToNode(t,e),t.active=!0,o.utilsAnimFx.replayParticle(t.children[0]),i.setTimeout(function(){return t.removeFromParent(!0)},1200)},bombExplosion:function(){var e=this;this.particleBomb.setPosition(o.cellMechanic.cellPosToRealPos(o.powerItems.currentCellX,o.powerItems.currentCellY)),this.particleBomb.active=!0,o.utilsAnimFx.replayParticle(this.particleBomb.children[0]),i.setTimeout(function(){return e.particleBomb.active=!1},1200),o.audio.playSound("DAOBombHit")},scoreSingleLine:function(e,t){void 0===t&&(t=!1);var n=i.copyNode(this.particleScoreSingleLine,this.fxContainer);n.active=!0,n.x=0,n.y=o.cellMechanic.cellPosToRealPos(0,e).y,o.utilsAnimFx.replayParticle(n.children[0]),i.setTimeout(function(){return n.removeFromParent(!0)},1200),t||o.audio.playSound("LineScoreBasic")},scoreMultipleLines:function(e){var t=this;if(e.length<4)e.map(function(e){return t.scoreSingleLine(e,!0)}),o.audio.playSound("LineScoreBasic");else{var n=0;e.map(function(e){return n+=e}),n/=e.length;var r=o.cellMechanic.cellPosToRealPos(0,n).y;this.particleCombo4Lines.y=r,this.particleCombo4Lines.active=!0,o.utilsAnimFx.replayParticle(this.particleCombo4Lines.children[0]),i.setTimeout(function(){return t.particleCombo4Lines.active=!1},1200),o.audio.playSound("LineScoreTetris")}},showScoreComboText:function(e){var t=["Single Combo!","Double Combo!","Triple Combo!","Super Combo!","Mega Combo!","Epic Combo!","Ultra Combo!","+Ultra Combo!"],n=t[e-1]||t[t.length-1],i=cc.find("Canvas/fx_container/combo_text");o.utilsUI.fillLabel(i,n),i.stopAllActions(),cc.tween(i).repeat(4,cc.tween().to(.2,{opacity:255}).to(.2,{opacity:0})).to(.2,{opacity:0}).start()},showBakudanText:function(){var e=cc.find("Canvas/fx_container/bakudan_text");e.stopAllActions(),cc.tween(e).repeat(4,cc.tween().to(.2,{opacity:255}).to(.2,{opacity:0})).to(.2,{opacity:0}).start()},showBlockLands:function(e,t){var n,i=this;e||0===e||(e=(n=[o.cellMechanic.currentCellX,o.cellMechanic.currentCellY])[0],t=n[1]),this.particleBlockLands.setPosition(o.cellMechanic.cellPosToRealPos(e,t)),this.particleBlockLands.active=!0,this.particleBlockLands.stopAllActions(),o.utilsAnimFx.replayParticle(this.particleBlockLands.children[0]),cc.tween(this.particleBlockLands).delay(1).call(function(){return i.particleBlockLands.active=!1}).start(),o.audio.playSound("BlockLand")},showFastDropParticle:function(e){var t=this,n=o.cellMechanic.cellPosToRealPos(e.x,e.y);(!this.particleBlockFastDrop.active||n.y>this.particleBlockFastDrop.y)&&(this.particleBlockFastDrop.active=!0,i.setGlobalPosToNode(this.particleBlockFastDrop,o.gameMechanic.currentBlockNode)),this.particleBlockFastDrop.stopAllActions(),cc.tween(this.particleBlockFastDrop).to(.2,{position:n}).call(function(){t.particleBlockFastDrop.active=!1}).start()},hideFastDropParticle:function(){this.particleBlockFastDrop.active=!1},currentBGSymbolIndex:0,bgSymbolCount:0,startBGDecorMoving:function(){var e=this,t=cc.find("Canvas/bg/decor"),n=cc.find("Canvas/sample_nodes/bg_decor"),o=n.width;this.bgSymbolCount=n.children.length;var r=1+cc.winSize.width/o;if(this.resetBgColor(),!this.isBGAnimating){this.isBGAnimating=!0;for(var l=function(e){e.opacity=155+i.randomNumber(100)},a=function(e){e.moveSpeed=100+i.randomNumber(300)},c=function(e){e.color=cc.color(i.randomNumber(255),i.randomNumber(255),i.randomNumber(255))},s=function(o,u){void 0===u&&(u=0);var d=cc.winSize.width/r,m=i.copyNode(n,t),f=m.children[e.currentBGSymbolIndex];f.scale=(4+i.randomNumber(14))/10,l(f),c(f),f.active=!0,o=o||i.randomNumber(r),o%=r,m.x=o*d-cc.winSize.width/2,m.y=1*(cc.winSize.height/2+100),a(m);var p=-1*(cc.winSize.height+200),h=i.abs(p/m.moveSpeed);cc.tween(m).delay(u).by(h,{y:p,angle:i.randomNumber(360)-180}).call(function(){m.removeFromParent(!0),s(o)}).start()},u=0;u<2*r;u++)s(u,i.floor(u/r))}},resetBgColor:function(){this.currentBGSymbolIndex=i.randomNumber(30)%this.bgSymbolCount,cc.find("Canvas/bg").color=cc.color(r[0])},changeBGToRandomColor:function(){this.currentBGSymbolIndex=(this.currentBGSymbolIndex+i.randomNumber(10))%this.bgSymbolCount;var e=cc.find("Canvas/bg");e.stopAllActions(),cc.tween(e).to(.3,{color:cc.Color.WHITE}).delay(.2).to(.5,{color:cc.color(i.randomArrItem(r))}).start();var t=cc.find("Canvas/bg/BG_GradientLayer"),n=cc.find("Canvas/bg/decor");t.stopAllActions(),n.stopAllActions(),cc.tween(t).to(.2,{opacity:255}).start(),cc.tween(n).to(.2,{opacity:255}).start()},changeBGToOrange:function(){var e=cc.find("Canvas/bg/BG_GradientLayer"),t=cc.find("Canvas/bg/decor");e.stopAllActions(),t.stopAllActions(),cc.tween(e).to(.4,{opacity:0}).start(),cc.tween(t).to(.4,{opacity:0}).start();var n=cc.find("Canvas/bg");n.stopAllActions(),cc.tween(n).repeatForever(cc.tween().to(.3,{color:cc.Color.WHITE}).delay(.1).to(.5,{color:cc.color("#ffb800")}).delay(.4)).start()}},cc._RF.pop()},{"../../system/all_modules":"all_modules"}],core_ui:[function(e,t,n){"use strict";var o,i;cc._RF.push(t,"b15554JuJ1HfrbLWDvHND0f","core_ui"),Object.defineProperty(n,"__esModule",{value:!0}),n.coreUI=void 0;var r=e("../../system/all_modules"),l=r._,a=((o={})[cc.macro.KEY.up]=180,o[cc.macro.KEY.down]=0,o[cc.macro.KEY.left]=-90,o[cc.macro.KEY.right]=90,o),c=((i={180:cc.macro.KEY.up,0:cc.macro.KEY.down})[-90]=cc.macro.KEY.left,i[90]=cc.macro.KEY.right,e("./bind_button_handlers"));n.coreUI={alertOKCallback:null,init:function(){c.bindButtonHandlers.run(),this.renderPowerItemKeyVisual()},updatePowerItemStates:function(){cc.find("Canvas/play_area/power_items/item_list").children.map(function(e){var t=r.powerItems.itemInventoryStates[e.name],n=t.number,o=t.coolDownTimeCounted;r.utilsUI.fillLabel(cc.find("label_number",e),n);var i=o/r.configGame.powerItemCoolDownTime[e.name];r.utilsUI.setNodeSpriteFillRange(cc.find("cool_down_layer",e),1-i),cc.find("key_visual",e).opacity=n?255:128})},renderPowerItemKeyVisual:function(){cc.find("Canvas/play_area/power_items/item_list").children.map(function(e){var t=r.configGame.powerItemKeys[e.name];cc.find("key_visual",e).children.map(function(e,n){e.active=n<t.length,e.angle=a[t[n]]}),cc.find("key_visual_shadow",e).children.map(function(e,n){e.active=n<t.length,e.angle=a[t[n]]})})},updatePowerItemArrowKeys:function(){var e=r.control.currentPowerItemKeyPressed,t=e.join("_"),n=Object.keys(r.control.keyCodeToPowerItemName).filter(function(e){return t&&e.startsWith(t)}).map(function(e){return r.control.keyCodeToPowerItemName[e]}),o=function(e){return e.color=cc.Color.WHITE};cc.find("Canvas/play_area/power_items/item_list").children.map(function(t){var i=t.name;n.includes(i)?cc.find("key_visual",t).children.map(function(t,n){n<e.length?t.color=cc.Color.BLUE:o(t)}):cc.find("key_visual",t).children.map(function(e){return o(e)})})},updateStats:function(){r.utilsUI.fillLabel(cc.find("Canvas/play_area/stats_container/label_score"),r.gameMechanic.statistic.score.toString()),r.utilsUI.fillLabel(cc.find("Canvas/layer_game_over/dialog/label_score"),r.gameMechanic.statistic.score.toString()),r.utilsUI.fillLabel(cc.find("Canvas/play_area/stats_container/line_count"),l.addLeadingZero(r.gameMechanic.statistic.lineCount,4)),r.utilsUI.fillLabel(cc.find("Canvas/play_area/level_container/level_num"),l.addLeadingZero(r.gameMechanic.statistic.level,5))},updateTimePassed:function(){r.utilsUI.fillLabel(cc.find("Canvas/play_area/stats_container/label_time"),l.secondsToTimeCountdown(r.gameMechanic.statistic.timePassed)),r.utilsUI.fillLabel(cc.find("Canvas/layer_game_over/dialog/label_time"),l.secondsToTimeCountdown(r.gameMechanic.statistic.timePassed))},showNewlyAddedScore:function(e){var t=cc.find("Canvas/play_area/stats_container/newly_added_score");t.stopAllActions(),r.utilsUI.fillLabel(t,"+"+e),cc.tween(t).to(.3,{opacity:255}).delay(2).to(.3,{opacity:0}).start()},adjustUI:function(){cc.winSize.width/cc.winSize.height>.5625&&(cc.find("Canvas").getComponent(cc.Canvas).fitWidth=!1,cc.find("Canvas").getComponent(cc.Canvas).fitHeight=!0),["Canvas/play_area","Canvas/bg","Canvas/control_layer","Canvas/layout_win","Canvas/layout_settings","Canvas/fx_container","Canvas/nag_screen","Canvas/layout_fixed_header","Canvas/layout_tutorial"].map(function(e){cc.find(e).height=cc.winSize.height})},showLayout:function(e){(l.isString(e)?cc.find("Canvas/"+e):e).active=!0},hideLayout:function(e){(l.isString(e)?cc.find("Canvas/"+e):e).active=!1},showAlert:function(e,t){this.showLayout("layer_alert"),r.utilsUI.fillLabel(cc.find("Canvas/layer_alert/bg_msg/label_msg"),e),this.alertOKCallback=t},hideLoadingTimer:null,showLoading:function(){var e=this;this.showLayout("layer_loading"),this.hideLoadingTimer&&clearTimeout(this.hideLoadingTimer),this.hideLoadingTimer=setTimeout(function(){return e.hideLoading()},1e4)},hideLoading:function(){this.hideLayout("layer_loading"),this.hideLoadingTimer&&clearTimeout(this.hideLoadingTimer)},showNagScreen:function(e){var t=this;cc.find("Canvas/nag_screen").active=!0,e&&l.setTimeout(function(){return t.hideNagScreen()},1e3*e)},hideNagScreen:function(){cc.find("Canvas/nag_screen").active=!1}},cc._RF.pop()},{"../../system/all_modules":"all_modules","./bind_button_handlers":"bind_button_handlers"}],free_button_comp:[function(e,t,n){"use strict";cc._RF.push(t,"ee307OeX0lMvqRwlJoeXArM","free_button_comp");var o,i=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),r=this&&this.__decorate||function(e,t,n,o){var i,r=arguments.length,l=r<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(l=(r<3?i(l):r>3?i(t,n,l):i(t,n))||l);return r>3&&l&&Object.defineProperty(t,n,l),l};Object.defineProperty(n,"__esModule",{value:!0});var l=e("../../system/all_modules"),a=(l._,l.$,cc._decorator),c=a.ccclass,s=(a.property,function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.freeHandler=function(e){e.target.freeButtonHandlerFunc&&e.target.freeButtonHandlerFunc(e.target)},r([c],t)}(cc.Component));n.default=s,cc._RF.pop()},{"../../system/all_modules":"all_modules"}],game_flow:[function(e,t,n){"use strict";cc._RF.push(t,"133e2EyA7BEH6xD94DPj2u1","game_flow"),Object.defineProperty(n,"__esModule",{value:!0}),n.gameFlow=void 0;var o=e("../system/all_modules");o._,o.$,n.gameFlow={init:function(){}},cc._RF.pop()},{"../system/all_modules":"all_modules"}],game_mechanic:[function(e,t,n){"use strict";cc._RF.push(t,"438ea0dqARKwKWtyk/Ae8uA","game_mechanic"),Object.defineProperty(n,"__esModule",{value:!0}),n.gameMechanic=void 0;var o=e("../system/all_modules"),i=o._,r=(o.$,o.types.blockType);n.gameMechanic={elemBufferContainer:null,elemContainer:null,currentElemArr:[],previousBlockNode:null,currentBlockNode:null,currentBlockType:null,fixedCellPosArr:[],level:1,isGameOver:!1,isPaused:!1,isPlayingAnim:!1,consecutiveScore:0,statistic:{lineCount:0,level:1,score:0,currentDropScore:0,timePassed:0},init:function(){this.elemContainer=o.mapVisual.elemContainer,this.elemBufferContainer=cc.find("Canvas/play_area/block_buffer/blocks"),this.startGame(),this.startTimeCount()},startTimeCount:function(){var e=this;setInterval(function(){e.isGameOver||e.isPaused||(e.statistic.timePassed++,o.coreUI.updateTimePassed())},1e3)},startGame:function(){o.coreFX.startBGDecorMoving(),"off"!=o.settings.music&&o.audio.unmuteBgMusic(),o.mapVisual.clearMap(),Object.assign(this,{currentElemArr:[],currentBlockNode:null,currentBlockType:null,fixedCellPosArr:[],level:1,isGameOver:!1,isPaused:!1,isPlayingAnim:!1,consecutiveScore:0,statistic:{lineCount:0,level:1,score:0,currentDropScore:0,timePassed:0}}),o.cellMechanic.reset(),o.powerItems.reset(),o.coreUI.updateStats(),o.coreUI.updateTimePassed();for(var e=0;e<4;e++)this.currentElemArr.push(this.getNewRandomElem());this.popElemFromBuffer(),cc.director.resume()},replay:function(){this.startGame(),o.audio.onReplay()},onLose:function(){this.isGameOver=!0,o.audio.onGameOver(),o.coreUI.showLayout("layer_game_over")},pause:function(){cc.director.pause(),o.coreUI.showLayout("layer_pause"),this.isPaused=!0,o.audio.muteBgMusic()},resume:function(){cc.director.resume(),o.coreUI.hideLayout("layer_pause"),this.isPaused=!1,"off"!=o.settings.music&&o.audio.unmuteBgMusic()},onBlockLanded:function(){var e=this.getScoredDeadCellArr();this.handleCellRemovals(e)},handleCellRemovals:function(e){var t=this,n=function(){t.popElemFromBuffer(),o.coreUI.hideNagScreen()};if(!e||!e.length)return n();var i=o.powerItems.getAllPylonExtraDeadCellArr(e);o.coreUI.showNagScreen(),this.removeMapCells(i,function(){t.handleCollapsing(n)})},handleCollapsing:function(e){for(var t=this,n=[],r=i.getNumberArray(1,o.mapVisual.mapCellWidth),l=function(e){if(!r.every(function(n){return!t.getFixedCellPos({x:n,y:e})}))return"continue";n.push(e)},a=0;a<=o.mapVisual.mapCellHeight;a++)l(a);var c=[];n.map(function(e){t.elemContainer.children.slice(0).map(function(t){t.active&&t.parent&&t.cellPos&&t.cellPos.y>e&&(t.missingCellYDown=(t.missingCellYDown||0)+1,i.addUniqueElemToArr(c,t))})});var s=i.max.apply(i,c.map(function(e){return e.missingCellYDown}))||0;c.map(function(e){var t=e.missingCellYDown;e.cellPos.y-=t;var n=o.cellMechanic.cellPosToRealPos(e.cellPos.x,e.cellPos.y);cc.tween(e).to(.05*t,{x:n.x,y:n.y}).start(),e.missingCellYDown=0}),this.fixedCellPosArr=this.fixedCellPosArr.filter(function(e){return!n.includes(e.y)}),n.length&&n.slice(0).reverse().map(function(e){t.fixedCellPosArr.map(function(t){t.y>e&&t.y--})}),i.setTimeout(function(){return e&&e()},50*s+100)},getScoredDeadCellArr:function(){for(var e=this,t=[],n=[],r=i.getNumberArray(1,o.mapVisual.mapCellWidth),l=function(o){if(!r.every(function(t){return e.getFixedCellPos({x:t,y:o})}))return"continue";t.push(o),n.push.apply(n,r.map(function(e){return{x:e,y:o}}))},a=0;a<=o.mapVisual.mapCellHeight;a++)l(a);return this.handleScore(t.length),t.length?(1==t.length?o.coreFX.scoreSingleLine(t[0]):t.length>1&&o.coreFX.scoreMultipleLines(t),this.consecutiveScore++,this.consecutiveScore>1&&o.coreFX.showScoreComboText(this.consecutiveScore-1),t.length>=4&&o.coreFX.showBakudanText()):this.consecutiveScore=0,n},handleScore:function(e){if(e){e>1&&o.coreFX.changeBGToRandomColor();var t=this.statistic.level*(o.configGame.scoringFactor[e-1]||1);e>4&&(t=this.statistic.level*o.configGame.extraScoringFactor+(5+e));var n=this.statistic.currentDropScore,i=(n+o.configGame.comboExtraScore)*this.statistic.level,r=t+(e>1?i:0)+n;this.statistic.lineCount+=e,this.addScore(r)}},addScore:function(e){this.statistic.score+=e;var t=this.statistic.level;this.statistic.level=o.configGame.scoreToLevel(this.statistic.score),t!=this.statistic.level&&this.onNewLevel(),o.coreUI.updateStats(),o.coreUI.showNewlyAddedScore(e)},onNewLevel:function(){this.statistic.level,o.coreFX.changeBGToRandomColor()},getFixedCellPos:function(e){return this.fixedCellPosArr.find(function(t){return t.x==e.x&&t.y==e.y})},removeFixedCellPos:function(e){var t=this.getFixedCellPos(e);return i.removeArrayItem(this.fixedCellPosArr,t),!!t},removeMapCells:function(e,t,n){var o=this;void 0===n&&(n=.1),e.map(function(e){return o.removeSingleMapCell(e,n)}),i.setTimeout(function(){return t&&t()},1e3*n+100)},removeSingleMapCell:function(e,t){if(void 0===t&&(t=0),this.removeFixedCellPos(e)){var n=o.cellMechanic.getSingleCellNode(e);t?cc.tween(n).to(t,{opacity:0}).call(function(){return n.removeFromParent(!0)}).start():n.removeFromParent(!0)}},stopBlockFalling:function(){var e,t=this,n=o.cellMechanic,r=n.currentLocalCellArr.map(function(e){return{x:e[0]+n.currentCellX,y:e[1]+n.currentCellY}});(e=this.fixedCellPosArr).push.apply(e,r),this.currentBlockNode.visualNode.children.slice(0).map(function(e){e.scale=e.parent.scale*o.mapVisual.singleCellScaleFactor,e.angle=90*n.currentSpinState,e.anchorX={0:0,1:0,2:1,3:1}[n.currentSpinState],e.anchorY={0:0,1:1,2:1,3:0}[n.currentSpinState];var r=e.cellPos.add(cc.v2(n.currentCellX,n.currentCellY)),l=n.cellPosToRealPos(r.x,r.y);e.cellPos=r,e.setPosition(l),e.parent=t.elemContainer;var a=i.copyNode(cc.find("Canvas/sample_nodes/cell_highlight"),e);a.setPosition(0,0),["anchorX","anchorY"].map(function(t){return a[t]=e[t]}),cc.tween(a).to(.2,{opacity:255}).delay(.1).to(.2,{opacity:0}).call(function(){return a.removeFromParent()}).start()}),o.coreFX.showBlockLands(),this.isGameOver||(this.isPlayingAnim=!0,this.onBlockLanded())},blockFallTimerVar:null,startNewBlockFall:function(){var e=this;this.isPlayingAnim=!1;var t=o.cellMechanic;this.statistic.currentDropScore=0;var n=1e3*(o.configGame.blockFallTimeFactor+1)/(o.configGame.blockFallTimeFactor+this.statistic.level);t.setBlockLocalCells(0);var r=i.floor(o.mapVisual.mapCellWidth/2)-(this.currentBlockType==o.types.blockType.I?1:0),l=o.mapVisual.mapCellHeight-t.currentBlockCellMaxY-1;if("hit_fixed_cells"==t.setBlockCellPos(r,l,!0))return this.onLose();i.clearInterval(this.blockFallTimerVar),this.blockFallTimerVar=i.setInterval(function(){o.powerItems.isUsingItem||e.isPlayingAnim||t.setBlockCellPos(null,t.currentCellY-1)},n)},getNewElem:function(e){var t=i.copyNode(cc.find("Canvas/sample_nodes/block"),null);return t.visualNode=o.utilsUI.showOnlyChildNodeWithNameAs(cc.find("visual",t),e),t.blockType=e,t},lastRandomElemType:null,getNewRandomElem:function(){var e=[r.L,r.I,r.O,r.T,r.S,r.Z,r.J];this.lastRandomElemType&&i.removeArrayItem(e,this.lastRandomElemType);var t=this.lastRandomElemType=i.randomArrItem(e);return this.getNewElem(t)},popElemFromBuffer:function(){var e=o.powerItems.isJustUsedItem,t=e?this.getNewElem(this.currentBlockType):this.currentElemArr.shift();t.parent=this.elemContainer,this.currentBlockNode&&this.currentBlockNode.removeFromParent(!0),this.previousBlockNode=this.currentBlockNode,this.currentBlockNode=t,this.currentBlockType=t.blockType,e||(this.currentElemArr.push(this.getNewRandomElem()),this.updateElemBuffer()),o.powerItems.isJustUsedItem=!1,this.startNewBlockFall()},updateElemBuffer:function(){var e=this;this.elemBufferContainer.removeAllChildren(),this.currentElemArr.map(function(t){var n=i.copyNode(t.visualNode,e.elemBufferContainer);n.children.map(function(e){return e.anchorX=e.anchorY=.5}),n.anchorX=.5,n.scale=.25,n.x=-n.width*n.scale/4})}},cc._RF.pop()},{"../system/all_modules":"all_modules"}],map_visual:[function(e,t,n){"use strict";cc._RF.push(t,"8e0baH2ZLtGQb52+gG4oZRe","map_visual"),Object.defineProperty(n,"__esModule",{value:!0}),n.mapVisual=void 0;var o=e("../system/all_modules");o._,o.$,n.mapVisual={mapCellWidth:10,mapCellHeight:18,cellWidthInPx:0,blockCellOrgSize:56,elemContainer:null,powerItemContainer:null,gridNode:null,singleCellScaleFactor:1,init:function(){this.gridNode=cc.find("Canvas/play_area/grid"),this.elemContainer=cc.find("Canvas/play_area/elem_container"),this.powerItemContainer=cc.find("Canvas/play_area/power_item_container"),this.cellWidthInPx=this.gridNode.width/this.mapCellWidth;var e=this.singleCellScaleFactor=this.cellWidthInPx/56;cc.find("Canvas/sample_nodes/block/visual").scale=e,cc.find("Canvas/sample_nodes/single_cell").scale=e},clearMap:function(){this.elemContainer.removeAllChildren(),this.powerItemContainer.removeAllChildren()},render:function(){}},cc._RF.pop()},{"../system/all_modules":"all_modules"}],power_item:[function(e,t,n){"use strict";cc._RF.push(t,"20432UHV2FFVIz3/nlerHx4","power_item");var o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},i=this&&this.__spreadArrays||function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var o=Array(e),i=0;for(t=0;t<n;t++)for(var r=arguments[t],l=0,a=r.length;l<a;l++,i++)o[i]=r[l];return o};Object.defineProperty(n,"__esModule",{value:!0}),n.powerItems=void 0;var r=e("../system/all_modules"),l=r._,a=(r.$,r.gameMechanic),c=[[0,0],[0,1],[1,0],[1,1]];n.powerItems={itemContainer:null,itemInventoryStates:{bomb:{number:0,coolDownTimeCounted:0},drill:{number:0,coolDownTimeCounted:0},pylon:{number:0,coolDownTimeCounted:0},noggle:{number:0,coolDownTimeCounted:0}},isUsingItem:!1,isItemFalling:!1,currentItemName:null,currentItemNode:null,currentCellX:0,currentCellY:0,currentPylonNodeArr:[],isJustUsedItem:null,init:function(){var e=this;this.itemContainer=cc.find("Canvas/play_area/power_item_container"),l.addPseudoUpdateFunc(function(t){return e.powerItemTimerTickFunc(t)})},reset:function(){Object.assign(this,{itemInventoryStates:{bomb:{number:0,coolDownTimeCounted:0},drill:{number:0,coolDownTimeCounted:0},pylon:{number:0,coolDownTimeCounted:0},noggle:{number:0,coolDownTimeCounted:0}},isUsingItem:!1,currentItemName:null,currentItemNode:null,currentCellX:0,currentCellY:0,currentPylonNodeArr:[],isJustUsedItem:null}),r.coreUI.updatePowerItemStates(),l.clearInterval(this.itemFallTimerVar)},powerItemTimerTickFunc:function(e){if(!a.isGameOver&&!a.isPaused){for(var t in this.itemInventoryStates){var n=this.itemInventoryStates[t],o=r.configGame.powerItemMaxNumber[t];n.number<o&&(n.coolDownTimeCounted+=e,n.coolDownTimeCounted>r.configGame.powerItemCoolDownTime[t]&&(n.number++,n.number<o&&(n.coolDownTimeCounted=0)))}r.coreUI.updatePowerItemStates()}},onUse:function(e){if(!this.isUsingItem&&!a.isPlayingAnim){var t=this.itemInventoryStates[e];t.number<=0||(r.audio.playSound("InitializeAbility"),t.number--,t.coolDownTimeCounted>=r.configGame.powerItemCoolDownTime[e]&&(t.coolDownTimeCounted=0),r.coreUI.updatePowerItemStates(),"noggle"!==e?this.onStartNormalPowerItem(e):this.noggle(),this.isUsingItem=!0,a.currentBlockNode.active=!1,this.isJustUsedItem=!0)}},bomb:function(){this.currentItemNode.removeFromParent(!0);for(var e=r.configGame.powerItemAbilities.bomb.explosionRange,t=[this.currentCellX,this.currentCellY,e.width,e.height],n=t[2],o=t[3],i=[],l=t[0]+1,c=t[1]+1,s=-n/2;s<n/2;s++)for(var u=-o/2;u<o/2;u++)i.push({x:l+s,y:c+u});r.coreFX.bombExplosion(),a.handleCellRemovals(i),this.isUsingItem=!1},drill:function(){var e=this;l.setTimeout(function(){return e.realDrillFunc()},300),this.currentItemNode.stopAllActions(),r.coreFX.showBlockLands(this.currentCellX,this.currentCellY)},realDrillFunc:function(){var e=this;this.showTrailingVfx(),cc.tween(this.currentItemNode).by(1,{y:-1200}).call(function(){e.currentItemNode.removeFromParent(!0)}).start(),l.setTimeout(function(){return r.audio.stopSound("MechaDrill")},500);for(var t=a.fixedCellPosArr,n=this.currentCellY-1;n>=0;n--)for(var i=function(e){var i=e+c.currentCellX;if(a.getFixedCellPos({x:i,y:n}))return"continue";var s=l.copyNode(cc.find("Canvas/sample_nodes/single_cell"),a.elemContainer),u={x:i,y:n};s.cellPos=u,s.setPosition(r.cellMechanic.cellPosToRealPos(u.x,u.y)),t.push(o({},u)),s.opacity=0,cc.tween(s).delay(.05*(c.currentCellY-n)).to(.2,{opacity:255}).call(function(){r.coreFX.drillParticles(s),r.audio.playSound("MechaDrillBlockPlace")}).start()},c=this,s=0;s<=1;s++)i(s);l.setTimeout(function(){var t=a.getScoredDeadCellArr();e.currentPylonNodeArr.filter(function(t){var n=t.parent.cellPos.x;return l.abs(n-e.currentCellX)<2}).map(function(n){var o=e.pylonNodeToDeadCellArr(n);t=e.mergeCellArr(t,o),e.pylonExplodeVfx(n)}),a.handleCellRemovals(t),e.isUsingItem=!1},700)},pylon:function(){var e=this,t=this.currentItemNode;t.singleCellNodeArr=[];var n=cc.find("pylon_bg",this.currentItemNode);if(n.active=!0,n.scale*=r.mapVisual.singleCellScaleFactor,c.map(function(n,i){var c=l.copyNode(cc.find("Canvas/sample_nodes/single_cell"),a.elemContainer);c.pylonItemNode=t;var s=c.cellPos={x:e.currentCellX+n[0],y:e.currentCellY+n[1]};a.fixedCellPosArr.push(o({},s)),c.setPosition(r.cellMechanic.cellPosToRealPos(s.x,s.y)),c.getComponent(cc.Sprite).enabled=!1,t.singleCellNodeArr.push(c),0==i&&(c.getComponent(cc.Sprite).enabled=!1,t.parent=c,t.setPosition(0,0),t.scale*=1/c.scale)}),this.currentPylonNodeArr.length>2){var i=[];this.currentPylonNodeArr.slice(0).map(function(t){i=e.mergeCellArr(i,e.pylonNodeToDeadCellArr(t)),e.pylonExplodeVfx(t)}),a.handleCellRemovals(i)}else r.gameMechanic.onBlockLanded();this.isUsingItem=!1},pylonNodeToDeadCellArr:function(e){for(var t=e.parent.cellPos.y,n=[],o=l.getNumberArray(1,r.mapVisual.mapCellWidth),i=function(e){o.map(function(t){return n.push({x:t,y:e})})},a=t;a<t+1+1;a++)i(a);return n},getAllPylonExtraDeadCellArr:function(e){for(var t=this,n=[],o=i(e),l=e,a=10,c=function(){var e=[];l.map(function(i){var l=r.cellMechanic.getSingleCellNode(i);if(l){var a=l.pylonItemNode;!a||a.isExploding||n.includes(a)||(n.push(a),t.pylonExplodeVfx(a),e.push.apply(e,t.getDiffCellArr(o,t.pylonNodeToDeadCellArr(a))))}}),o.push.apply(o,e),l=e};l.length&&a--;)c();return o},isHandlingPylonExplode:!1,accumulatedPylonScore:0,pylonExplodeVfx:function(e){var t=this;e.isExploding=!0,l.removeArrayItem(this.currentPylonNodeArr,e),r.coreFX.pylonExplosion(e),cc.tween(e).to(.2,{opacity:0}).call(function(){return e.removeFromParent(!0)}).start(),this.isHandlingPylonExplode||(this.isHandlingPylonExplode=!0,this.accumulatedPylonScore=0,l.setTimeout(function(){t.isHandlingPylonExplode=!1,r.gameMechanic.addScore(t.accumulatedPylonScore)},500),r.audio.playSound("PylongExplode")),this.accumulatedPylonScore+=r.configGame.powerItemAbilities.pylon.explodeScore;var n=l.copyNode(cc.find("Canvas/sample_nodes/pylon_explode_text"),r.coreFX.fxContainer);l.setGlobalPosToNode(n,e),cc.tween(n).repeat(4,cc.tween().to(.2,{opacity:255}).to(.2,{opacity:0})).to(.2,{opacity:0}).call(function(){return n.removeFromParent(!0)}).start()},noggle:function(){var e=this;r.coreFX.changeBGToOrange();var t=l.copyNode(cc.find("Canvas/sample_nodes/noggle"),this.itemContainer);t.y=r.mapVisual.mapCellHeight*r.mapVisual.cellWidthInPx/2,this.currentItemNode=t,this.currentItemName="noggle",this.isItemFalling=!0,this.currentCellY=r.mapVisual.mapCellHeight-1;var n=l.max.apply(l,a.fixedCellPosArr.map(function(e){return e.y}))||0;this.isUsingItem=!0;var o=function(n){void 0===n&&(n=!1),n||a.handleCellRemovals([]),l.clearInterval(e.itemFallTimerVar),cc.tween(t).delay(.5).by(.4,{y:1200}).call(function(){r.coreFX.changeBGToRandomColor(),e.isUsingItem=!1,t.removeFromParent(),e.currentPylonNodeArr.slice(0).map(function(t){t.activeInHierarchy||l.removeArrayItem(e.currentPylonNodeArr,t)})}).start()},i=r.configGame.powerItemAbilities.noggle.maxSmashLine;l.clearInterval(this.itemFallTimerVar),this.itemFallTimerVar=l.setInterval(function(){if(t.y-=r.mapVisual.cellWidthInPx,e.currentCellY--,e.currentCellY<0)return o();if(e.currentCellY<=n){cc.find("noggle_tail",e.currentItemNode).active=!0;var l=n-e.currentCellY+1;if(l>i)return o(!0);r.audio.playSound("NoggleSmash");var c=r.cellMechanic.getAllCellPosOfRow(e.currentCellY);l==i?a.handleCellRemovals(c):a.removeMapCells(c)}},1/3*1e3)},itemFallTimerVar:null,onStartNormalPowerItem:function(e){var t=this,n=l.copyNode(cc.find("Canvas/sample_nodes/power_item"),this.itemContainer);this.currentItemNode=n,this.currentItemName=e,"pylon"==e&&this.currentPylonNodeArr.push(n),r.utilsUI.showOnlyChildNodeWithNameAs(cc.find("visual",n),e);var o=r.cellMechanic.currentCellX,i=r.mapVisual.mapCellHeight-1-1;this.setItemCellPos(o,i),this.isNewCellPosInvalid(o,i)&&l.log("power item collidng fixed cell blocks !!!"),this.isItemFalling=!0,l.clearInterval(this.itemFallTimerVar),this.itemFallTimerVar=l.setInterval(function(){t.hideTrailingVfx(),t.setItemCellPos(null,t.currentCellY-1)},1/3*1e3)},setItemCellPos:function(e,t,n){var o,i=this;if(void 0===e&&(e=null),void 0===t&&(t=null),void 0===n&&(n=!1),"noggle"!=this.currentItemName&&!(a.isGameOver||a.isPaused||(null===e&&(e=this.currentCellX),null===t&&(t=this.currentCellY),e<1))){var c=this.isNewCellPosInvalid(e,t),s=c&&(0==this.currentCellY||this.currentCellY==t+1);s&&"drill"===this.currentItemName&&r.audio.playSound("MechaDrill",1,!0),s&&!n&&this.onItemHitBlocks(),c||(o=[e,t],this.currentCellX=o[0],this.currentCellY=o[1]);var u=cc.v2(e-1,t).mul(r.mapVisual.cellWidthInPx);if(u=u.sub(cc.v2(r.mapVisual.gridNode.width/2,r.mapVisual.gridNode.height/2)),!c)if(n){this.currentItemNode.stopAllActions();var d=l.abs(u.y-this.currentItemNode.y)/3e3;cc.tween(this.currentItemNode).to(d,{position:u}).call(function(){i.onItemHitBlocks()}).start()}else this.currentItemNode.setPosition(u);return!c}},fastDropItem:function(){if(!a.isGameOver&&!a.isPaused&&this.isItemFalling)if("noggle"!=this.currentItemName){l.clearInterval(this.itemFallTimerVar),this.showTrailingVfx();for(var e=0;e<r.mapVisual.mapCellHeight&&this.setItemCellPos(null,this.currentCellY-1,"bomb"==this.currentItemName);e++);}else{var t=a.fixedCellPosArr.length?l.max.apply(l,a.fixedCellPosArr.map(function(e){return e.y})):0,n=this.currentCellY-t-1;n>0&&(this.currentCellY=t+1,this.currentItemNode.y-=n*r.mapVisual.cellWidthInPx)}},isNewCellPosInvalid:function(e,t){return c.some(function(n){var o=n[0],i=n[1];return o+e<1||o+e>r.mapVisual.mapCellWidth||i+t<0||i+t>r.mapVisual.mapCellHeight-1||a.getFixedCellPos({x:e+o,y:t+i})})},onItemHitBlocks:function(){l.clearInterval(this.itemFallTimerVar),this.isItemFalling=!1,this[this.currentItemName](),"pylon"==this.currentItemName&&(cc.find("vfx/pylon_lands",this.currentItemNode).active=!0,cc.find("vfx/pylon_overlay",this.currentItemNode).active=!0,r.audio.playSound("PylonLand"))},mergeCellArr:function(e,t){var n=i(e);return t.map(function(e){n.find(function(t){return t.x==e.x&&t.y==e.y})||n.push(e)}),n},getDiffCellArr:function(e,t){return t.filter(function(t){return!e.find(function(e){return t.x==e.x&&t.y==e.y})})},showTrailingVfx:function(){"drill"==this.currentItemName?cc.find("vfx/mecha_drill_tail",this.currentItemNode).active=!0:"bomb"==this.currentItemName&&(cc.find("vfx/bomb_trail",this.currentItemNode).x=0)},hideTrailingVfx:function(){"drill"==this.currentItemName?cc.find("vfx/mecha_drill_tail",this.currentItemNode).active=!1:"bomb"==this.currentItemName&&(cc.find("vfx/bomb_trail",this.currentItemNode).x=-9999)}},cc._RF.pop()},{"../system/all_modules":"all_modules"}],project_init_comp:[function(e,t,n){"use strict";cc._RF.push(t,"6a573g+HCdKnYr0iab16Em0","project_init_comp");var o,i=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),r=this&&this.__decorate||function(e,t,n,o){var i,r=arguments.length,l=r<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(l=(r<3?i(l):r>3?i(t,n,l):i(t,n))||l);return r>3&&l&&Object.defineProperty(t,n,l),l};Object.defineProperty(n,"__esModule",{value:!0});var l=e("../system/all_modules"),a=(l._,l.$,cc._decorator),c=a.ccclass,s=(a.property,function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.start=function(){window._G=l},t.prototype.onLoad=function(){for(var e in cc.game.on(cc.game.EVENT_SHOW,function(){return l.appEvents.onAppShow()}),cc.game.on(cc.game.EVENT_HIDE,function(){return l.appEvents.onAppHide()}),l)l[e].init&&l[e].init()},r([c],t)}(cc.Component));n.default=s,cc._RF.pop()},{"../system/all_modules":"all_modules"}],settings:[function(e,t,n){"use strict";cc._RF.push(t,"47b954QQ/RNPrn+v8nMvQ+H","settings"),Object.defineProperty(n,"__esModule",{value:!0}),n.settings=void 0;var o=e("../system/all_modules"),i=(o._,o.$,["sound","music"]);n.settings={node:null,sound:"on",music:"on",isInitialized:!1,init:function(){var e=this;o.utilsData.load(i,function(t){e.sound=t.sound||"on",e.music=t.music||"on",e.updateAllSoundBtnStates(),e.isInitialized=!0})},onBtnMusic:function(){this.music="off",o.utilsData.save({music:this.music}),o.audio.muteBgMusic(),this.updateAllSoundBtnStates()},onBtnMusicOff:function(){this.music="on",o.utilsData.save({music:this.music}),o.audio.unmuteBgMusic(),this.updateAllSoundBtnStates()},onBtnSound:function(){this.sound="off",o.utilsData.save({sound:this.sound}),this.updateAllSoundBtnStates()},onBtnSoundOff:function(){this.sound="on",o.utilsData.save({sound:this.sound}),this.updateAllSoundBtnStates()},updateAllSoundBtnStates:function(){cc.find("Canvas/layer_pause/dialog/btn_music/btn_music_off").active="off"==this.music,cc.find("Canvas/layer_pause/dialog/btn_sound/btn_sound_off").active="off"==this.sound}},cc._RF.pop()},{"../system/all_modules":"all_modules"}],system_types:[function(e,t,n){"use strict";cc._RF.push(t,"58815dIE85L1qOkNfwP8ZkR","system_types"),Object.defineProperty(n,"__esModule",{value:!0}),n.blockType=void 0,function(e){e.T="T",e.L="L",e.J="J",e.S="S",e.Z="Z",e.I="I",e.O="O"}(n.blockType||(n.blockType={})),cc._RF.pop()},{}],tutorial:[function(e,t,n){"use strict";cc._RF.push(t,"9fa024zMbVB+Lq+UeHKKCS8","tutorial"),Object.defineProperty(n,"__esModule",{value:!0}),n.tutorial=void 0;var o=e("../system/all_modules");o._,o.$,n.tutorial={node:null,isShowingTut:!1,currentStep:0,init:function(){},start:function(){this.isShowingTut=!0,this.currentStep=1},onBtnContinue:function(){}},cc._RF.pop()},{"../system/all_modules":"all_modules"}],utils_anim_fx:[function(e,t,n){"use strict";cc._RF.push(t,"e273ec92dRLKKGQF99UI9/D","utils_anim_fx");var o=this&&this.__spreadArrays||function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var o=Array(e),i=0;for(t=0;t<n;t++)for(var r=arguments[t],l=0,a=r.length;l<a;l++,i++)o[i]=r[l];return o};Object.defineProperty(n,"__esModule",{value:!0}),n.utilsAnimFx=void 0;var i=e("../../system/all_modules"),r=i._;n.utilsAnimFx={fxNodePool:{},init:function(){},replayParticle:function(e){e&&e.getComponent(cc.ParticleSystem)&&(e.active=!0,e.getComponent(cc.ParticleSystem).resetSystem())},playNodeAnim:function(e,t,n,o,i){void 0===o&&(o=!1);var r=e.getComponent(cc.Animation);if(e.activeInHierarchy&&r&&(t=t||(r.defaultClip?r.defaultClip.name:""))){var l=r[o?"playAdditive":"play"](t);if(l)return l.repeatCount=(-1==n?1/0:n)||1,i&&r.on("finished",function(){r.off("finished"),i()}),l}},playNodeAnimAsSoonAsNodeActive:function(e,t,n,o){var i=this;void 0===n&&(n=1),void 0===o&&(o=!0);var l="waitInterval2PlayAnimWhenActive";e[l]=r.waitToRun(function(){e[l]&&clearInterval(e[l]),i.playNodeAnim(e,t,n,o)},"activeInHierarchy",e)},playNodeAnimArr:function(e,t,n,i){var r=this;if(void 0===n&&(n=!1),e.activeInHierarchy){var l=e.getComponent(cc.Animation);if(e.activeInHierarchy&&l){var a=o(t);l.on("finished",function(){a.length?r.playNodeAnim(e,a.shift(),1,n):(l.off("finished"),i&&i())}),this.playNodeAnim(e,a.shift(),1,n)}}},stopAllNodeAnims:function(e){var t=e.getComponent(cc.Animation);t&&(t.stop(),t.off("finished"))},stopAnimAtFrame0:function(e){var t=this,n=e.getComponent(cc.Animation);n.play("ufo_ring_fx"),r.setTimeout(function(){n.setCurrentTime(0),t.stopAllNodeAnims(e)})},playIncreasingNumberLabel:function(e,t,n,o,i,l,a){void 0===o&&(o=5),void 0===i&&(i=.5),void 0===l&&(l=0),void 0===a&&(a="xxx");var c=e.getComponent(cc.Label),s=n/o,u=i/o;cc.tween(e).delay(l).repeat(o,cc.tween().call(function(){t+=s;var e=r.formatMoney(r.round(t));c.string=a.replace(/xxx/g,e)}).delay(u)).start()},getNewFxNode:function(e,t){e.nodePoolId||(e.nodePoolId=r.getNewUuid()),this.fxNodePool[e.nodePoolId]||(this.fxNodePool[e.nodePoolId]=[]);var n=this.fxNodePool[e.nodePoolId].pop()||r.copyNode(e);return n.nodePoolId=e.nodePoolId,n.parent=t||i.coreFX.fxContainer,n},saveFxNodeToPool:function(e){e.stopAllActions(),e.active=!1,this.fxNodePool[e.nodePoolId].unshift(e)},particlesFlyFromA2B:function(e,t,n,o,i){for(var l=this,a=o||{numberOfNode:20,delayStartTime:.05,flyDuration:1,randomBezierPointRange:{x:200,y:200}},c=a.numberOfNode,s=a.flyDuration,u=a.delayStartTime,d=a.randomBezierPointRange,m=r.getGlobalPosDiff(t,n),f=function(n){var o=p.getNewFxNode(e,i);o.active=!0,o.opacity=255,r.setGlobalPosToNode(o,t);var a=p.getRandomPointInRage(d),c=p.getRandomPointInRage(d);cc.tween(o).delay(n*u).bezierBy(s,a,c,m).call(function(){l.saveFxNodeToPool(o)}).start()},p=this,h=0;h<c;h++)f(h)},getRandomPointInRage:function(e){return cc.v2(r.randomNumber(2*e.x)-e.x,r.randomNumber(2*e.y)-e.y)},nodeFlyFromAtoB:function(e,t,n,o){void 0===n&&(n=.3);var i=r.getGlobalPosDiff(e,t);cc.tween(e).by(n,{position:i}).call(function(){return o&&o()}).start()},captureNodeToTexture:function(e){e.activeInHierarchy||(e.active=!0);var t=new cc.Node;e.addChild(t);var n=t.addComponent(cc.Camera),o=new cc.RenderTexture,i=cc.game._renderContext;o.initWithSize(e.width,e.height,i.STENCIL_INDEX8),n.targetTexture=o,n.zoomRatio=1.3,n.backgroundColor=cc.Color.WHITE,n.clearFlags=cc.Camera.ClearFlags.DEPTH|cc.Camera.ClearFlags.STENCIL|cc.Camera.ClearFlags.COLOR;var r=o.width,l=o.height,a=document.createElement("canvas");a.width=r,a.height=l;var c=a.getContext("2d");n.render(e);for(var s=o.readPixels(),u=4*r,d=0;d<l;d++){var m=l-1-d,f=new Uint8ClampedArray(s.buffer,m*r*4,u),p=new ImageData(f,r,1);c.putImageData(p,0,d)}var h=a.toDataURL("image/jpeg");return setTimeout(function(){e.active=!1,t.removeFromParent()},1e3),h}},cc._RF.pop()},{"../../system/all_modules":"all_modules"}],utils_common:[function(e,t,n){"use strict";cc._RF.push(t,"38328hs45lM85Ud0D0XUutA","utils_common");var o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},i=this&&this.__spreadArrays||function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var o=Array(e),i=0;for(t=0;t<n;t++)for(var r=arguments[t],l=0,a=r.length;l<a;l++,i++)o[i]=r[l];return o};Object.defineProperty(n,"__esModule",{value:!0}),n._=n.$=void 0;var r=e("../../system/all_modules"),l=e("./utils_time"),a=e("./utils_coordinate"),c=1e5;n.$=function(e,t){void 0===t&&(t=0),n._.$callCount=(n._.$callCount||0)+1,e.name!=r.types.elem.card&&(t=0);var o=e["props_"+t]||{};return e["props_"+t]=o},n.$.clean=function(e,t){void 0===t&&(t=0),0!=t&&delete e["props_"+t]},n._=o(o({NO_CONSOLE_LOG:!1,isANDROID:cc.sys.os==cc.sys.OS_ANDROID,isIOS:cc.sys.os==cc.sys.OS_IOS,max:Math.max,min:Math.min,round:Math.round,floor:Math.floor,ceil:Math.ceil,sign:Math.sign,abs:Math.abs,pow:Math.pow,random:Math.random,sqrt:Math.sqrt,sin:Math.sin,cos:Math.cos,tan:Math.tan,atan:Math.atan,atan2:Math.atan2,log10:Math.log10,PI:Math.PI,randomArrItem:function(e,t){void 0===t&&(t=!1);var n=Math.floor(Math.random()*e.length);return t?e.splice(n,1)[0]:e[n]},isString:function(e){return"string"==typeof e},isFunction:function(e){return e&&"[object Function]"==={}.toString.call(e)},log:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(!this.NO_CONSOLE_LOG)try{console.log.apply(console,e)}catch(n){}},getNewUuid:function(){return c++},removeArrayItem:function(e,t){var n=e.indexOf(t);-1!=n&&e.splice(n,1)},addUniqueElemToArr:function(e,t){e.includes(t)||e.push(t)},getNumberArray:function(e,t){void 0===e&&(e=1);for(var n=[],o=e;o<=t;o++)n.push(o);return n},randomNumber:function(e){return n._.floor(n._.random()*e)},shuffleArray:function(e,t){var n=this;void 0===t&&(t=!1);var o=t?i(e):e;return o.sort(function(){return n.random()>.5?1:-1}),o},directionVec2:function(){return{top:cc.v2(0,1),bottom:cc.v2(0,-1),left:cc.v2(-1,0),right:cc.v2(1,0)}},reservedDir:function(e){return{top:"bottom",bottom:"top",left:"right",right:"left"}[e]},getGlobalPos:function(e){return e.convertToWorldSpaceAR(cc.Vec2.ZERO)},getGlobalPosDiff:function(e,t){return this.getGlobalPos(t).sub(this.getGlobalPos(e))},setGlobalPosToNode:function(e,t){var n=this.getGlobalPos(t),o=e.parent.convertToNodeSpaceAR(n);e.setPosition(o)},setGlobalPos:function(e,t){var n=e.parent.convertToNodeSpaceAR(t);e.setPosition(n)},moveToNewParentKeepPosition:function(e,t){var n=t.convertToNodeSpaceAR(this.getGlobalPos(e));e.parent=t,e.setPosition(n)},isGlobalOverlapping:function(e,t){return cc.Intersection.rectRect(e.getBoundingBoxToWorld(),t.getBoundingBoxToWorld())},getBezierPointFunc:function(e){return function(t){for(var n=e;n.length>1;n=r)for(var o,i=0,r=[];i<n.length-1;i++)for(r[i]=[],o=0;o<n[i].length;o++)r[i][o]=n[i][o]*(1-t)+n[i+1][o]*t;return n[0]}},copyNode:function(e,t){var n=cc.instantiate(e);return t&&(n.parent=t),n},setOrgProp:function(e,t){var n=this,o=["x","y","width","height","opacity"];if(t&&this.addUniqueElemToArr(o,t),o.map(function(t){var o="org"+n.capitalize(t);e[o]=e.hasOwnProperty(o)?e[o]:e[t]}),t)return e["org"+this.capitalize(t)]},getNodePath:function(e){for(var t=[e.name],n=e.parent,o=0;n&&o++<50&&n.parent;)t.push(n.name),n=n.parent;return t.reverse().join(" ")},nodeConnect2Points:function(e,t,o){var i=o.sub(t);e.height=i.mag(),e.setPosition(t.add(i.mul(.5))),e.angle=90+n._.radianToDegrees(n._.atan2(i.y,i.x))},getNodeDistance:function(e,t){return this.getGlobalPosDiff(e,t).mag()},radianToDegrees:function(e){return 180*e/Math.PI},degreesToRadian:function(e){return e*Math.PI/180},vec2ToAngle:function(e){return n._.radianToDegrees(n._.atan2(e.y,e.x))},formatTime:function(e){var t=n._.floor(e/3600),o=n._.floor(e%3600/60),i=e%3600%60;return t<10&&(t="0"+t),o<10&&(o="0"+o),i<10&&(i="0"+i),t+":"+o+":"+i},formatMoney:function(e){var t=n._.floor(Math.log10(e))+1;if(t<=6)return e.toLocaleString();var o,i=n._.floor((t-1)/3);return o=i-2<=3?["K","M","B","T"][i-2]:String.fromCharCode((i-6)/26+"a".charCodeAt(0))+String.fromCharCode((i-6)%26+"a".charCodeAt(0)),n._.round(e/n._.pow(10,3*(i-1))).toLocaleString()+o},capitalize:function(e){var t=i(e);return t[0]=t[0].toUpperCase(),t.join("")},addLeadingZero:function(e,t){for(var n=e.toString();n.length<t;)n="0"+n;return n},getInRange:function(e,t,o){return n._.min(n._.max(e,t),o)}},l.default),a.default),cc._RF.pop()},{"../../system/all_modules":"all_modules","./utils_coordinate":"utils_coordinate","./utils_time":"utils_time"}],utils_coordinate:[function(e,t,n){"use strict";cc._RF.push(t,"5df86zHog5HcqIKMKzmLV+k","utils_coordinate"),Object.defineProperty(n,"__esModule",{value:!0}),e("../../system/all_modules").$;var o=e("./utils_common");n.default={isVecHorz:function(e){return o._.abs(e.x)>o._.abs(e.y)},getPointRanges:function(e){var t=99999999,n=99999999,i=-99999999,r=-99999999;return e.map(function(e){t=o._.min(t,e.x),n=o._.min(n,e.y),i=o._.max(i,e.x),r=o._.max(r,e.y)}),{minX:t,minY:n,maxX:i,maxY:r}},distance2polygon:function(e,t){function n(e,t,n){var o,i,r=e.x,l=e.y,a=t.x,c=t.y,s=n.x,u=n.y,d=s-a,m=u-c,f=d*d+m*m,p=-1;0!=f&&(p=((r-a)*d+(l-c)*m)/f),p<0?(o=a,i=c):p>1?(o=s,i=u):(o=a+p*d,i=c+p*m);var h=r-o,v=l-i;return Math.sqrt(h*h+v*v)}return t.map(function(o,i){var r=t[i+1]||t[0];return n(e,o,r)}).sort(function(e,t){return e>t?1:-1})[0]}},cc._RF.pop()},{"../../system/all_modules":"all_modules","./utils_common":"utils_common"}],utils_data:[function(e,t,n){"use strict";cc._RF.push(t,"55e17+IhfZAOKUumwaKfgIH","utils_data"),Object.defineProperty(n,"__esModule",{value:!0}),n.utilsData=void 0;var o=e("../../system/all_modules");o._,o.$,n.utilsData={save:function(e,t){for(var n in e)localStorage.setItem(n,JSON.stringify(e[n]));setTimeout(function(){t&&t()},300)},load:function(e,t){var n={};e.map(function(e){if(null!==localStorage.getItem(e))try{n[e]=JSON.parse(localStorage.getItem(e))}catch(t){console.warn(" utilsData.load() >> Error  data key = "+e+" ",t)}}),t&&setTimeout(function(){return t(n)},100)}},cc._RF.pop()},{"../../system/all_modules":"all_modules"}],utils_time:[function(e,t,n){"use strict";cc._RF.push(t,"f9b241Zt2BFFa5XMWEu3uey","utils_time"),Object.defineProperty(n,"__esModule",{value:!0});var o=e("../../system/all_modules"),i=(o.$,e("./utils_common")),r=1e5;n.default={getMsPassedUTC:function(){return(new Date).getTime()},getMsPassedPT:function(){var e=this.getPacificTimeOffset();return this.getMsPassedUTC()+36e5*e},getTimePT:function(e){void 0===e&&(e=new Date);var t=this.getPacificTimeOffset(e),n=e.getHours()+e.getTimezoneOffset()/60;return e.setHours(n+t),e},isSameDate:function(e,t){return e.getFullYear()==t.getFullYear()&&e.getMonth()==t.getMonth()&&e.getDate()==t.getDate()},getTotalMsToMidnightPT:function(){return 864e5-this.getMsPassedPT()%864e5},getDSTStartEndDate:function(e){var t=(e||new Date).getFullYear(),n=new Date(t,2,1),o=(7-n.getDay())%7,i=n.getDate()+o+7,r=new Date(t,2,i),l=new Date(t,10,1),a=(7-l.getDay())%7,c=l.getDate()+a;return[r,new Date(t,10,c)]},getPacificTimeOffset:function(e){var t=e||new Date,n=this.getDSTStartEndDate(),o=n[0],i=n[1];return t>o&&t<i?-7:-8},setTimeout:function(e,t){void 0===t&&(t=0);var n={_id:r++,__instanceId:r,callback:null};return n.callback=function(){e(n)},cc.director.getScheduler().schedule(n.callback,n,t/1e3,0,0,!1),n},clearTimeout:function(e){e&&e._id&&e.callback&&cc.director.getScheduler().unschedule(e.callback,e)},setInterval:function(e,t){void 0===t&&(t=0);var n={_id:r++,__instanceId:r,callback:null};return n.callback=function(){e(n)},cc.director.getScheduler().schedule(n.callback,n,t/1e3,cc.macro.REPEAT_FOREVER,0,!1),n},clearInterval:function(e){e&&e._id&&e.callback&&cc.director.getScheduler().unschedule(e.callback,e)},addPseudoUpdateFunc:function(e){var t=this,n=this.getMsPassedUTC();return this.setInterval(function(){var r=t.getMsPassedUTC(),l=r-i._.max(n,o.appEvents.lastAppHideMsUTC);n=r,e(l/1e3)},.01)},secondsToTimeCountdown:function(e){if(void 0===e&&(e=0),e<=0)return"0:00";var t=Math.floor(e/86400),n=Math.floor(e%86400/3600),o=Math.floor(e%3600/60),i=e%60;if(t>2)return t+" days";if(1==t)return"1 day";var r="";return n>0&&(r=n+":"),(r+=o+":")+(i>=10?i:"0"+i)},waitToRun:function(e,t,n,o,i,r){void 0===n&&(n=window),void 0===o&&(o=.1);var l=!1,a=t.startsWith("!"),c=t.endsWith("()");t=t.replace("!","").replace("()","");var s,u=c?function(){return n[t]()}:null,d=function(){if(a){if(c){if(u())return}else if(n[t])return}else if(c){if(!u())return}else if(!n[t])return;return clearInterval(s),l=!0,e(n[t]),!0};return d()?s:(s=setInterval(d,1e3*o),i&&this.setTimeout(function(){clearInterval(s),r&&!l&&r()},1e3*i),s)}},cc._RF.pop()},{"../../system/all_modules":"all_modules","./utils_common":"utils_common"}],utils_ui:[function(e,t,n){"use strict";cc._RF.push(t,"fac22cBTNdDypWs3FUVCI/a","utils_ui"),Object.defineProperty(n,"__esModule",{value:!0}),n.utilsUI=void 0;var o=e("../../system/all_modules"),i=o._,r=(o.$,{touchstart:[],touchmove:[],touchend:[]});n.utilsUI={init:function(){},fillLabel:function(e,t){(e.getComponent(cc.Label)||e.getComponent(cc.RichText)).string=t},fillChildLabelByPath:function(e,t,n){var o=cc.find(t,e);o&&this.fillLabel(o,n)},showOnlyChildNodeWithNameAs:function(e,t,n){var o;return void 0===n&&(n=!1),e.children.map(function(e){var i=e.name==t;i&&(o=e),e.active=i,n&&(e.opacity=i?255:0)}),o},setLabelCountDownTimer:function(e,t,n){"string"==typeof e&&(e=cc.find(e)),e.countDownTimerVar&&clearInterval(e.countDownTimerVar);var r=function(){if(!e.parent)return clearInterval(e.countDownTimerVar);var r=t-i.getMsPassedUTC(),l=i.secondsToTimeCountdown(i.floor(r/1e3));o.utilsUI.fillLabel(e,l),r<=0&&(clearInterval(e.countDownTimerVar),n&&n())};e.countDownTimerVar=setInterval(r,500),r()},setNodeSprite:function(e,t){e&&e.getComponent(cc.Sprite)&&(e.getComponent(cc.Sprite).spriteFrame=t)},setNodeSpriteFromUrl:function(e,t,n){var o=this;e&&e.getComponent(cc.Sprite)&&cc.assetManager.loadRemote(t,function(t,i){return t||o.setNodeSprite(e,new cc.SpriteFrame(i)),n&&n(i)})},setNodeSpriteFillRange:function(e,t){e&&e.getComponent(cc.Sprite)&&(e.getComponent(cc.Sprite).fillRange=t)},makeButton:function(e,t,n,l){var a=i.isString(e)?cc.find(e):e;i.setTimeout(function(){a||i.log("undefined node path = "+e),a.getComponent("free_button_comp")||a.addComponent("free_button_comp");var c=a.addComponent(cc.Button);c.transition=n?cc.Button.Transition.SCALE:null,c.zoomScale=e.buttonCompZoomScale||1.2;var s=new cc.Component.EventHandler;s.target=a,s.component="free_button_comp",s.handler="freeHandler",c.clickEvents.push(s),a.freeButtonHandlerFunc=function(){t(),l||o.audio.playSound("button_click"),r.touchstart.map(function(e){return e()})}})},makeBubbleButton:function(e,t){return this.makeButton(e,t,!0)},singleTouchSet:function(e,t,n,o){var i=function(e,t,n){e(t.touch.getLocation(),t,n)};e.on("touchstart",function(n){e._customTouchId||(e._customTouchId=n.touch._id+1,t&&i(t,n,e._customTouchId))}),n&&e.on("touchmove",function(t){var o=t.touch._id+1;o==e._customTouchId&&n&&i(n,t,o)});var r=function(t){var n=t.touch._id+1;n==e._customTouchId&&(e._customTouchId=null,o&&i(o,t,n))};e.on("touchend",r),e.on("touchcancel",r)},bindCanvasTouchHandler:function(){var e=cc.find("Canvas");this.singleTouchSet(e,function(e){r.touchstart.map(function(t){return t(e)})},function(e){r.touchmove.map(function(t){return t(e)})},function(e){r.touchend.map(function(t){return t(e)})})},addCanvasTouchHandler:function(e,t){var n=r[e];n&&n.push(t)}},cc._RF.pop()},{"../../system/all_modules":"all_modules"}]},{},["control","block_local_cells","cell_mechanic","game_flow","game_mechanic","map_visual","power_item","settings","tutorial","audio","free_button_comp","utils_anim_fx","utils_common","utils_coordinate","utils_data","utils_time","utils_ui","all_modules","app_events","config_game","project_init_comp","system_types","bind_button_handlers","core_fx","core_ui"]);